#!/bin/bash
# TODO: rename this script, probably the other "rebuild" scripts too

THIS_DIR="$(cd "$(dirname "$0")"; pwd)"
BASE_DIR="$(dirname $(dirname $THIS_DIR))"
SOURCE_DIR="$BASE_DIR"
cd $SOURCE_DIR || exit 1

IMAGE_NAME="rails-baseimage"
# TODO: use interstitial versions to match source material, do not publish them
docker build -t "singlecellportal/$IMAGE_NAME:latest" . || exit 1 # Don't tag with actual version numbers until the publish script, so you can build, attempt publish, change version.txt when it fails, and re-attempt publish without having to build again
docker image ls | grep "\\b$IMAGE_NAME\\b" | grep "\\blatest\\b" || exit 1

# TODO: publish (separate script)
# TODO:     docker login
# TODO:     docker push "singlecellportal/$IMAGE_NAME:1.9.1"
